!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.calendar=t())}(self,(()=>(()=>{var e=[(e,t,i)=>{e.exports=i(1)("./src/core.js")},e=>{"use strict";e.exports=CKEditor5.dll},(e,t,i)=>{e.exports=i(1)("./src/widget.js")},(e,t,i)=>{e.exports=i(1)("./src/ui.js")},,(e,t,i)=>{e.exports=i(1)("./src/utils.js")}],t={};function i(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};return(()=>{"use strict";i.d(n,{default:()=>g});var e=i(0),t=i(2);function s(e){if("<"===e[0]&&!(e=function(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelector("iframe");return t?t.getAttribute("src"):null}(e)))return null;let t;try{t=new URL(e)}catch(e){return null}return t.hostname.match(/(www|calendar)\.google\.com/)&&t.pathname.match(/\/calendar\/embed\/?/)?t.searchParams.toString():null}function r(e){return"https://calendar.google.com/calendar/embed?"+e}class o extends e.Command{constructor(e){super(e),this.set("existingCalendarSelected",!1)}execute(e={value:""}){const t=e.value.trim(),i=this.editor.model;if(!t)return;let n=s(t);n&&i.change((e=>i.insertContent(e.createElement("googleCalendar",{calendarQueryString:n}))))}refresh(){const{model:e}=this.editor,{selection:t}=e.document,i=t.getSelectedElement(),n=e.schema.findAllowedParent(t.getFirstPosition(),"googleCalendar");var s;this.isEnabled=null!==n,this.existingCalendarSelected=(s=i)&&"googleCalendar"===s.name?i:null}}class a extends e.Plugin{static get requires(){return[t.Widget]}init(){this._defineSchema(),this._defineConverters(),this._defineCommands()}_defineSchema(){this.editor.model.schema.register("googleCalendar",{isObject:!0,allowWhere:"$block",allowAttributes:["calendarQueryString"],allowChildren:!1})}_defineConverters(){const e=this.editor.conversion;e.attributeToAttribute({model:{key:"calendarQueryString",value:e=>e.getAttribute("data-query-string").replace(/&amp;/g,"&")},view:"data-query-string"}),e.for("upcast").elementToElement({model:"googleCalendar",view:{name:"ucb-calendar",classes:["ucb-calendar","ucb-google-calendar"]}}),e.for("dataDowncast").elementToElement({model:"googleCalendar",view:(e,{writer:t})=>l(e,t)}),e.for("editingDowncast").elementToElement({model:"googleCalendar",view:(e,{writer:t})=>l(e,t,!0)})}_defineCommands(){this.editor.commands.add("insertCalendar",new o(this.editor))}}function l(e,i,n=!1){if(n){const n=e.getAttribute("calendarQueryString")||"";return(0,t.toWidget)(i.createContainerElement("div",{class:"ucb-calendar ucb-google-calendar"},[i.createEmptyElement("iframe",{src:r(n),loading:"lazy",referrerpolicy:"no-referrer",frameborder:"0",scrolling:"no"}),i.createEmptyElement("div",{class:"ucb-calendar-editing-cover"})]),i,{label:"calendar widget"})}return i.createContainerElement("ucb-calendar",{class:"ucb-calendar ucb-google-calendar"})}var c=i(3),d=i(5);class u extends c.View{constructor(t){super(t),this.valueInputView=this._createInput(t,"Calendar embed"),this.set("value",""),this.valueInputView.fieldView.bind("value").to(this,"value"),this.saveButtonView=this._createActionButton(t,"Save",e.icons.check,"ck-button-save"),this.cancelButtonView=this._createActionButton(t,"Cancel",e.icons.cancel,"ck-button-cancel"),this.saveButtonView.type="submit",this.cancelButtonView.delegate("execute").to(this,"cancel"),this.childViews=this.createCollection([this.valueInputView,this.saveButtonView,this.cancelButtonView]),this._enableFocusTracking(),this.setTemplate({tag:"form",attributes:{class:["ck","ck-calendar-form"],tabindex:"-1"},children:this.childViews})}render(){super.render();for(const e of this.childViews)this.focusTracker.add(e.element);(0,c.submitHandler)({view:this}),this.keystrokes.listenTo(this.element)}focus(){this.valueInputView.focus()}reset(){this.value="",this.valueInputView.fieldView.element.blur(),this.element.reset()}destroy(){this.keystrokes.destroy()}_createSelectableButton(e,t,i,n,s){const r=new c.ButtonView;return r.set({label:e.t(t),icon:i,tooltip:!!i,isToggleable:!0,withText:!i}),r.bind("isOn").to(this,n,(e=>e===s)),this.listenTo(r,"execute",(()=>{this.set(n,s)})),r}_createActionButton(e,t,i,n){const s=new c.ButtonView;return s.set({label:e.t(t),icon:i,class:n,tooltip:!!i,withText:!i}),s}_createInput(e,t){const i=new c.LabeledFieldView(e,c.createLabeledInputText);return i.label=e.t(t),i}_enableFocusTracking(){this.focusTracker=new d.FocusTracker,this.keystrokes=new d.KeystrokeHandler,this.focusTracker.on("change:focusedElement",((e,t,i)=>{i===this.valueInputView.element&&this.valueInputView.fieldView.element.select()})),this.focusCycler=new c.FocusCycler({focusables:this.childViews,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}})}}class h extends e.Plugin{static get requires(){return[c.ContextualBalloon]}init(){const e=this.editor,t=e.commands.get("insertCalendar"),i=e.editing.view.document,n=e.ui.componentFactory;this._balloon=e.plugins.get(c.ContextualBalloon),this.formView=this._createFormView(e.locale),n.add("calendar",(e=>{const n=new c.ButtonView(e);return n.set({label:e.t("Calendar"),icon:'<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512">\x3c!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM48 192h80v56H48V192zm0 104h80v64H48V296zm128 0h96v64H176V296zm144 0h80v64H320V296zm80-48H320V192h80v56zm0 160v40c0 8.8-7.2 16-16 16H320V408h80zm-128 0v56H176V408h96zm-144 0v56H64c-8.8 0-16-7.2-16-16V408h80zM272 248H176V192h96v56z"/></svg>',tooltip:!0,isToggleable:!0}),n.bind("isEnabled").to(t,"isEnabled"),n.bind("isOn").to(t,"existingCalendarSelected"),this.listenTo(n,"execute",(()=>{this._showUI(t.existingCalendarSelected)})),this.listenTo(i,"click",(()=>{t.existingCalendarSelected&&this._showUI(t.existingCalendarSelected)})),n}))}_createFormView(e){const t=this.editor,i=new u(e);return this.listenTo(i,"submit",(()=>{t.execute("insertCalendar",{value:i.valueInputView.fieldView.element.value}),this._hideUI()})),this.listenTo(i,"cancel",(()=>this._hideUI())),(0,c.clickOutsideHandler)({emitter:i,activator:()=>this._balloon.visibleView===i,contextElements:[this._balloon.view.element],callback:()=>this._hideUI()}),i.keystrokes.set("Esc",((e,t)=>{this._hideUI(),t()})),i}_showUI(e){if(this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),e){const t=e.getAttribute("calendarQueryString");t&&"googleCalendar"===e.name&&(this.formView.value=r(t)),this.editor.model.change((t=>t.setSelection(e,"on")))}this.formView.focus()}_hideUI(){this.formView.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus()}_getBalloonPositionData(){const e=this.editor.editing.view,t=e.document;return{target:()=>e.domConverter.viewRangeToDom(t.selection.getFirstRange())}}}class m extends e.Plugin{static get requires(){return[a,h]}}const g={Calendar:m}})(),n=n.default})()));