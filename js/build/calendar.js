!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.calendar=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"ckeditor5/src/widget.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/widget.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,i),s.exports}i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";i.d(r,{default:()=>g});var e=i("ckeditor5/src/core.js"),t=i("ckeditor5/src/widget.js");function n(e){if("<"===e[0]&&!(e=function(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelector("iframe");return t?t.getAttribute("src"):null}(e)))return null;let t;try{t=new URL(e)}catch(e){return null}return"calendar.google.com"!==t.hostname||"/calendar/embed"!==t.pathname&&"/calendar/embed/"!==t.pathname?null:t.searchParams.toString()||null}function s(e){return"https://calendar.google.com/calendar/embed?"+e}class o extends e.Command{constructor(e){super(e),this.set("existingCalendarSelected",!1)}execute(e={value:""}){const t=e.value.trim(),i=this.editor.model;if(!t)return;let r=n(t);r&&i.change((e=>i.insertContent(e.createElement("googleCalendar",{calendarQueryString:r}))))}refresh(){const{model:e}=this.editor,{selection:t}=e.document,i=t.getSelectedElement(),r=e.schema.findAllowedParent(t.getFirstPosition(),"googleCalendar");var n;this.isEnabled=null!==r,this.existingCalendarSelected=(n=i)&&"googleCalendar"===n.name?i:null}}class l extends e.Plugin{static get requires(){return[t.Widget]}init(){this._defineSchema(),this._defineConverters(),this._defineCommands()}_defineSchema(){this.editor.model.schema.register("googleCalendar",{isObject:!0,allowWhere:"$block",allowAttributes:["calendarQueryString"],allowChildren:!1})}_defineConverters(){const e=this.editor.conversion;e.attributeToAttribute({model:"calendarQueryString",view:"data-query-string"}),e.for("upcast").elementToElement({model:"googleCalendar",view:{name:"ucb-calendar",classes:["ucb-calendar","ucb-google-calendar"]}}),e.for("dataDowncast").elementToElement({model:"googleCalendar",view:(e,{writer:t})=>a(e,t)}),e.for("editingDowncast").elementToElement({model:"googleCalendar",view:(e,{writer:t})=>a(e,t,!0)})}_defineCommands(){this.editor.commands.add("insertCalendar",new o(this.editor))}}function a(e,i,r=!1){if(r){const r=e.getAttribute("calendarQueryString")||"";return(0,t.toWidget)(i.createContainerElement("div",{class:"ucb-calendar ucb-google-calendar"},[i.createEmptyElement("iframe",{src:s(r),loading:"lazy",referrerpolicy:"no-referrer",frameborder:"0",scrolling:"no"}),i.createEmptyElement("div",{class:"ucb-calendar-editing-cover"})]),i,{label:"calendar widget"})}return i.createContainerElement("ucb-calendar",{class:"ucb-calendar ucb-google-calendar"})}var c=i("ckeditor5/src/ui.js"),d=i("ckeditor5/src/utils.js");class u extends c.View{constructor(t){super(t),this.valueInputView=this._createInput(t,"Calendar embed"),this.set("value",""),this.valueInputView.fieldView.bind("value").to(this,"value"),this.saveButtonView=this._createActionButton(t,"Save",e.icons.check,"ck-button-save"),this.cancelButtonView=this._createActionButton(t,"Cancel",e.icons.cancel,"ck-button-cancel"),this.saveButtonView.type="submit",this.cancelButtonView.delegate("execute").to(this,"cancel"),this.childViews=this.createCollection([this.valueInputView,this.saveButtonView,this.cancelButtonView]),this._enableFocusTracking(),this.setTemplate({tag:"form",attributes:{class:["ck","ck-calendar-form"],tabindex:"-1"},children:this.childViews})}render(){super.render();for(const e of this.childViews)this.focusTracker.add(e.element);(0,c.submitHandler)({view:this}),this.keystrokes.listenTo(this.element)}focus(){this.valueInputView.focus()}reset(){this.value="",this.valueInputView.fieldView.element.blur(),this.element.reset()}destroy(){this.keystrokes.destroy()}_createSelectableButton(e,t,i,r,n){const s=new c.ButtonView;return s.set({label:e.t(t),icon:i,tooltip:!!i,isToggleable:!0,withText:!i}),s.bind("isOn").to(this,r,(e=>e===n)),this.listenTo(s,"execute",(()=>{this.set(r,n)})),s}_createActionButton(e,t,i,r){const n=new c.ButtonView;return n.set({label:e.t(t),icon:i,class:r,tooltip:!!i,withText:!i}),n}_createInput(e,t){const i=new c.LabeledFieldView(e,c.createLabeledInputText);return i.label=e.t(t),i}_enableFocusTracking(){this.focusTracker=new d.FocusTracker,this.keystrokes=new d.KeystrokeHandler,this.focusTracker.on("change:focusedElement",((e,t,i)=>{i===this.valueInputView.element&&this.valueInputView.fieldView.element.select()})),this.focusCycler=new c.FocusCycler({focusables:this.childViews,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}})}}class h extends e.Plugin{static get requires(){return[c.ContextualBalloon]}init(){const e=this.editor,t=e.commands.get("insertCalendar"),i=e.editing.view.document,r=e.ui.componentFactory;this._balloon=e.plugins.get(c.ContextualBalloon),this.formView=this._createFormView(e.locale),r.add("calendar",(e=>{const r=new c.ButtonView(e);return r.set({label:e.t("Calendar"),icon:'<svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512">\x3c!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --\x3e<path d="M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM48 192h80v56H48V192zm0 104h80v64H48V296zm128 0h96v64H176V296zm144 0h80v64H320V296zm80-48H320V192h80v56zm0 160v40c0 8.8-7.2 16-16 16H320V408h80zm-128 0v56H176V408h96zm-144 0v56H64c-8.8 0-16-7.2-16-16V408h80zM272 248H176V192h96v56z"/></svg>',tooltip:!0,isToggleable:!0}),r.bind("isEnabled").to(t,"isEnabled"),r.bind("isOn").to(t,"existingCalendarSelected"),this.listenTo(r,"execute",(()=>{this._showUI(t.existingCalendarSelected)})),this.listenTo(i,"click",(()=>{t.existingCalendarSelected&&this._showUI(t.existingCalendarSelected)})),r}))}_createFormView(e){const t=this.editor,i=new u(e);return this.listenTo(i,"submit",(()=>{t.execute("insertCalendar",{value:i.valueInputView.fieldView.element.value}),this._hideUI()})),this.listenTo(i,"cancel",(()=>this._hideUI())),(0,c.clickOutsideHandler)({emitter:i,activator:()=>this._balloon.visibleView===i,contextElements:[this._balloon.view.element],callback:()=>this._hideUI()}),i.keystrokes.set("Esc",((e,t)=>{this._hideUI(),t()})),i}_showUI(e){if(this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),e){const t=e.getAttribute("calendarQueryString");t&&"googleCalendar"===e.name&&(this.formView.value=s(t)),this.editor.model.change((t=>t.setSelection(e,"on")))}this.formView.focus()}_hideUI(){this.formView.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus()}_getBalloonPositionData(){const e=this.editor.editing.view,t=e.document;return{target:()=>e.domConverter.viewRangeToDom(t.selection.getFirstRange())}}}class m extends e.Plugin{static get requires(){return[l,h]}}const g={Calendar:m}})(),r=r.default})()));